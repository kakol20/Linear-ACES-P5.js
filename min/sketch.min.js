const Manager=function(){var e,i,t,o,r,n,a,h,g,$,s,d,l,c,f,u,p,v,_,w,R=!1,m=!1,y=0,z=0,T=31,k=!0,F=!0,B=!0,S=5e3,b=[],G=0;function M(i){var t=i;u.position(5,t),t+=u.height+10,e.position(4,t),t+=e.height+5,$.position(5,t),t+=$.height+10,p.position(5,t),t+=p.height+5,_.position(6,t),t+=$.height+15,d.position(5,t),t+=d.height+10,l.position(5,t),t+=l.height+5,c.position(5,t),f.position(c.width+25,t),t+=f.height+10,a.position(5,t),t+=a.height+5,n.position(5,t),r.position(n.width+20,t),t+=r.height+5,h.position(5,t)}function x(){T=r.value(),k=a.checked(),F=d.checked(),B=l.checked(),S=f.value(),g=h.value(),v=p.checked(),w=_.value()}function A(e,i,t){return(e+i*t)*4}function C(e){"image"==e.type&&(t=createImg(e.data,"","anonymous",D)).hide()}function D(){x();var e=document.getElementById("upload").files[0];loadImage(URL.createObjectURL(e),e=>{if(v){if("Fit Width"===w)e.resize(windowWidth,0);else if("Fit Height"===w)e.resize(0,windowHeight);else if("Fit If Large"===w){if(e.width>windowWidth||e.height>windowHeight){var t=e.width/e.height,r=windowWidth/windowHeight;t>r?e.resize(windowWidth,0):t<r?e.resize(0,windowHeight):e.resize(windowWidth,0)}}else if("Fit Window"===w){var t=e.width/e.height,r=windowWidth/windowHeight;t>r?e.resize(windowWidth,0):t<r?e.resize(0,windowHeight):e.resize(windowWidth,0)}}resizeCanvas(e.width,e.height),i=new ImgWrap(width,height,ColorSpace.sRGB),background(28,28,28,0),image(e,0,0),R=!0,m=!1,o=!0,s=!1})}function E(){console.log("restart"),o&&(R=!0,m=!1,s=!0,background(0,0,0,0))}function K(){return"Progress: "+Math.floor(G/b.length*100)+"%"}return{preload(){(e=createFileInput(C)).id("upload"),($=createButton("Restart")).mousePressed(E),n=createSpan("Dither Factor: "),r=createInput(31,"number"),(a=createCheckbox(" Toggle Dither",!0)).changed(()=>{console.log("Dither toggle: "+a.checked())}),(h=createSelect()).option("RGB"),h.option("HSV"),h.option("CMYK"),h.selected("RGB"),h.changed(()=>{console.log("Dither Select: "+h.value())}),(d=createCheckbox(" Toggle ACES",!0)).changed(()=>{console.log("ACES toggle: "+d.checked())}),(l=createCheckbox(" Toggle Kelvin Tint",!1)).changed(()=>{console.log("Kelvin Tint toggle: "+l.checked())}),c=createSpan("Kelvin Temperature: "),f=createInput(5e3,"number"),u=createSpan("Progress: "),(p=createCheckbox(" Toggle Resize",!0)).changed(()=>{console.log("Resize Toggle: "+p.checked())}),(_=createSelect()).option("Fit If Large"),_.option("Fit Window"),_.option("Fit Width"),_.option("Fit Height"),_.selected("Fit If Large"),_.changed(()=>{console.log("Resize Method: "+_.value())}),M(5)},setup(){Random.Seed=BigInt(new Date),pixelDensity(1),createCanvas(windowWidth,windowHeight),loop()},draw(){if(!0===R){if(o){y=width*height,z=.016666666666666666*1e3,x(),M(height+5),loadPixels(),G=0,s||(i.loadPixels(pixels),b=[]),G=0;for(var e=0;e<height;e++)for(var t=0;t<width;t++){var r=i.index(t,e);s||b.push({index:r,x:t,y:e});for(var n=0;n<4;n++){var a=i.forOutput(r+n);pixels[r+n]=255*a}}s||console.log(b),updatePixels(),m=!0,d=0,l=0,s&&(s=!1)}else alert("Try choosing image again");R=!1}else if(m&&!R){loadPixels(),u.html(K());for(var h=new Date,$=0;$<y;$++){var r=b[G].index,d=b[G].x,l=b[G].y,c=[i.data[r+0],i.data[r+1],i.data[r+2],i.data[r+3]];F&&(c=LinearACES.ToneMap(c[0],c[1],c[2],c[3]));for(var n=0;n<4;n++)n<3&&(c[n]=sRGB.toSRGB(c[n]));if(B&&(c=Kelvin.Tint(c,S)),k){if("CMYK"===g){var f=CMYK.fromRGB(c);f=Dither.bayerArray(d,l,f,T),c=CMYK.toRGB(f)}else if("HSV"===g){var p=HSV.fromRGB(c);p=Dither.bayerArray(d,l,p,T),c=HSV.toRGB(p)}else c=Dither.bayerArray(d,l,c,T)}for(var n=0;n<4;n++)pixels[r+n]=Math.round(255*c[n])>>>0;if(++G>=b.length){u.html(K()),m=!1,console.log("-----PROCESS DONE -----");break}if(new Date-h>=z)break}updatePixels()}}}}();function preload(){Manager.preload()}function setup(){Manager.setup()}function draw(){Manager.draw()}