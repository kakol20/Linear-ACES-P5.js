const Manager=function(){let e=!1,t=!1,i,o,n,r,l=0,a=0,$=0,h=0,g=31,s,d,c=!0,f,u,p,_,w,R=!0,m,z=!0,v=5e3,T,k,y,F,B,b,G,M;function S(e){let t=e;F.position(5,t),t+=F.height+10,i.position(4,t),t+=i.height+5,_.position(5,t),t+=_.height+10,B.position(5,t),t+=B.height+5,G.position(6,t),t+=_.height+15,m.position(5,t),t+=m.height+10,T.position(5,t),t+=T.height+5,k.position(5,t),y.position(k.width+25,t),t+=y.height+10,f.position(5,t),t+=f.height+5,d.position(5,t),s.position(d.width+20,t),t+=s.height+5,u.position(5,t)}function A(){g=s.value(),c=f.checked(),R=m.checked(),z=T.checked(),v=y.value(),p=u.value(),b=B.checked(),M=G.value()}function C(e,t,i){return(e+t*i)*4}function D(e){"image"==e.type&&(n=createImg(e.data,"","anonymous",E)).hide()}function E(){A();let i=document.getElementById("upload"),n=i.files[0];loadImage(URL.createObjectURL(n),i=>{if(b){if("Fit Width"===M)i.resize(windowWidth,0);else if("Fit Height"===M)i.resize(0,windowHeight);else if("Fit If Large"===M){if(i.width>windowWidth||i.height>windowHeight){let n=i.width/i.height,l=windowWidth/windowHeight;n>l?i.resize(windowWidth,0):n<l?i.resize(0,windowHeight):i.resize(windowWidth,0)}}else if("Fit Window"===M){let a=i.width/i.height,$=windowWidth/windowHeight;a>$?i.resize(windowWidth,0):a<$?i.resize(0,windowHeight):i.resize(windowWidth,0)}}resizeCanvas(i.width,i.height),o=new ImgWrap(width,height,ColorSpace.sRGB),background(28,28,28,0),image(i,0,0),e=!0,t=!1,r=!0,w=!1})}function K(){console.log("restart"),r&&(e=!0,t=!1,w=!0,background(0,0,0,0))}function P(){var e,t,i;let n=(e=l,t=a,i=width,(e+t*i)*4+3);return"Progress: "+Math.floor(n/o.size*100)+"%"}return{preload(){(i=createFileInput(D)).id("upload"),(_=createButton("Restart")).mousePressed(K),d=createSpan("Dither Factor: "),s=createInput(31,"number"),(f=createCheckbox(" Toggle Dither",!0)).changed(()=>{console.log("Dither toggle: "+f.checked())}),(u=createSelect()).option("RGB"),u.option("HSV"),u.option("CMYK"),u.selected("RGB"),u.changed(()=>{console.log("Dither Select: "+u.value())}),(m=createCheckbox(" Toggle ACES",!0)).changed(()=>{console.log("ACES toggle: "+m.checked())}),(T=createCheckbox(" Toggle Kelvin Tint",!1)).changed(()=>{console.log("Kelvin Tint toggle: "+T.checked())}),k=createSpan("Kelvin Temperature: "),y=createInput(5e3,"number"),F=createSpan("Progress: "),(B=createCheckbox(" Toggle Resize",!0)).changed(()=>{console.log("Resize Toggle: "+B.checked())}),(G=createSelect()).option("Fit If Large"),G.option("Fit Window"),G.option("Fit Width"),G.option("Fit Height"),G.selected("Fit If Large"),G.changed(()=>{console.log("Resize Method: "+G.value())}),S(5)},setup(){pixelDensity(1),createCanvas(windowWidth,windowHeight),loop()},draw(){if(!0===e){if(r){$=width*height,h=.016666666666666666*1e3,A(),S(height+5),loadPixels(),w?w=!1:o.loadPixels(pixels);for(let i=0;i<width;i++)for(let n=0;n<height;n++){let s=o.index(i,n);for(let d=0;d<4;d++){let f=o.forOutput(s+d);pixels[s+d]=255*f}}updatePixels(),t=!0,l=0,a=0}else alert("Try choosing image again");e=!1}else if(t&&!e){loadPixels(),F.html(P());let u=new Date;for(let _=0;_<$;_++){var m,T,k;let y=(m=l,T=a,k=width,(m+T*k)*4),B=[o.data[y+0],o.data[y+1],o.data[y+2],o.data[y+3]];R&&(B=LinearACES.ToneMap(B[0],B[1],B[2],B[3]));for(let b=0;b<4;b++)b<3&&(B[b]=sRGB.toSRGB(B[b]));if(z&&(B=Kelvin.Tint(B,v)),c){if("CMYK"===p){let G=CMYK.fromRGB(B);G=Dither.bayerArray(l,a,G,g),B=CMYK.toRGB(G)}else if("HSV"===p){let M=HSV.fromRGB(B);M=Dither.bayerArray(l,a,M,g),B=HSV.toRGB(M)}else B=Dither.bayerArray(l,a,B,g)}for(let C=0;C<4;C++)pixels[y+C]=Math.round(255*B[C])>>>0;if(++l>=width&&(l=0,a++),a>=height){t=!1,F.html(P()),console.log("-----PROCESS DONE -----");break}let D=new Date,E=D-u;if(E>=h)break}updatePixels()}}}}();function preload(){Manager.preload()}function setup(){Manager.setup()}function draw(){Manager.draw()}