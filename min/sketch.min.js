const Manager=function(){var e,i,t,o,r,n,a,$,g,h,s,l,d,c,f,u,p,v,_,R,m=!1,w=!1,T=0,k=0,y=0,z=0,B=31,b=!0,G=!0,M=!0,S=5e3;function F(i){var t=i;u.position(5,t),t+=u.height+10,e.position(4,t),t+=e.height+5,h.position(5,t),t+=h.height+10,p.position(5,t),t+=p.height+5,_.position(6,t),t+=h.height+15,l.position(5,t),t+=l.height+10,d.position(5,t),t+=d.height+5,c.position(5,t),f.position(c.width+25,t),t+=f.height+10,a.position(5,t),t+=a.height+5,n.position(5,t),r.position(n.width+20,t),t+=r.height+5,$.position(5,t)}function A(){B=r.value(),b=a.checked(),G=l.checked(),M=d.checked(),S=f.value(),g=$.value(),v=p.checked(),R=_.value()}function C(e,i,t){return(e+i*t)*4}function D(e){"image"==e.type&&(t=createImg(e.data,"","anonymous",E)).hide()}function E(){A();var e=document.getElementById("upload").files[0];loadImage(URL.createObjectURL(e),e=>{if(v){if("Fit Width"===R)e.resize(windowWidth,0);else if("Fit Height"===R)e.resize(0,windowHeight);else{var t=e.width/e.height,r=windowWidth/windowHeight;t>r?e.resize(windowWidth,0):t<r?e.resize(0,windowHeight):e.resize(windowWidth,0)}}resizeCanvas(e.width,e.height),i=new ImgWrap(width,height,ColorSpace.sRGB),background(28,28,28,0),image(e,0,0),m=!0,w=!1,o=!0,s=!1})}function K(){console.log("restart"),o&&(m=!0,w=!1,s=!0,background(0,0,0,0))}function P(){var e,t,o;return"Progress: "+Math.floor((e=T,t=k,((e+t*(o=width))*4+3)/i.size*100))+"%"}return{preload(){(e=createFileInput(D)).id("upload"),(h=createButton("Restart")).mousePressed(K),n=createSpan("Dither Factor: "),r=createInput(31,"number"),(a=createCheckbox(" Toggle Dither",!0)).changed(()=>{console.log("Dither toggle: "+a.checked())}),($=createSelect()).option("RGB"),$.option("HSV"),$.option("CMYK"),$.selected("RGB"),$.changed(()=>{console.log("Dither Select: "+$.value())}),(l=createCheckbox(" Toggle ACES",!0)).changed(()=>{console.log("ACES toggle: "+l.checked())}),(d=createCheckbox(" Toggle Kelvin Tint",!1)).changed(()=>{console.log("Kelvin Tint toggle: "+d.checked())}),c=createSpan("Kelvin Temperature: "),f=createInput(5e3,"number"),u=createSpan("Progress: "),(p=createCheckbox(" Toggle Resize",!0)).changed(()=>{console.log("Resize Toggle: "+p.checked())}),(_=createSelect()).option("Fit Window"),_.option("Fit Width"),_.option("Fit Height"),_.selected("Fit Window"),_.changed(()=>{console.log("Resize Method: "+_.value())}),F(5)},setup(){pixelDensity(1),createCanvas(windowWidth,windowHeight),loop()},draw(){if(!0===m){if(o){y=width*height,z=.016666666666666666*1e3,A(),F(height+5),loadPixels(),s?s=!1:i.loadPixels(pixels);for(var e=0;e<width;e++)for(var t=0;t<height;t++)for(var r=i.index(e,t),n=0;n<4;n++){var a=i.forOutput(r+n);pixels[r+n]=255*a}updatePixels(),w=!0,T=0,k=0}else alert("Try choosing image again");m=!1}else if(w&&!m){loadPixels(),u.html(P());for(var $=new Date,h=0;h<y;h++){var l,d,c,r=(l=T,d=k,c=width,(l+d*c)*4),f=[i.data[r+0],i.data[r+1],i.data[r+2],i.data[r+3]];G&&(f=LinearACES.ToneMap(f[0],f[1],f[2],f[3]));for(var n=0;n<4;n++)n<3&&(f[n]=sRGB.toSRGB(f[n]));if(M&&(f=Kelvin.Tint(f,S)),b){if("CMYK"===g){var p=CMYK.fromRGB(f);p=Dither.bayerArray(T,k,p,B),f=CMYK.toRGB(p)}else if("HSV"===g){var v=HSV.fromRGB(f);v=Dither.bayerArray(T,k,v,B),f=HSV.toRGB(v)}else f=Dither.bayerArray(T,k,f,B)}for(var n=0;n<4;n++)pixels[r+n]=Math.round(255*f[n])>>>0;if(++T>=width&&(T=0,k++),k>=height){w=!1,u.html(P()),console.log("-----PROCESS DONE -----");break}if(new Date-$>=z)break}updatePixels()}}}}();function preload(){Manager.preload()}function setup(){Manager.setup()}function draw(){Manager.draw()}