const Manager=function(){var e,o,t,i,r,a,n,$,g,h,s,l,c,d,f,u,p=!1,_=!1,v=0,m=0,R=0,w=0,y=31,T=!0,k=!0,B=!0,G=5e3;function S(o){var t=o;u.position(5,t),t+=u.height+10,e.position(4,t),t+=e.height+5,h.position(5,t),h.mousePressed(C),t+=h.height+10,l.position(5,t),t+=l.height+10,c.position(5,t),t+=c.height+5,d.position(5,t),f.position(d.width+25,t),t+=f.height+10,n.position(5,t),t+=n.height+5,a.position(5,t),r.position(a.width+20,t),t+=r.height+5,$.position(5,t)}function b(e,o,t){return(e+o*t)*4}function M(e){"image"==e.type&&(t=createImg(e.data,"","anonymous",A)).hide()}function A(){resizeCanvas(t.width,t.height),o=new ImgWrap(width,height,ColorSpace.sRGB),background(28,28,28,0),image(t,0,0),p=!0,_=!1,i=!0,s=!1}function C(){console.log("restart"),i&&(p=!0,_=!1,s=!0,background(0,0,0,0))}function D(){var e,t,i;return"Progress: "+Math.floor((e=v,t=m,((e+t*(i=width))*4+3)/o.size*100))+"%"}return{preload(){e=createFileInput(M),h=createButton("Restart"),a=createSpan("Dither Factor: "),r=createInput(31,"number"),(n=createCheckbox(" Toggle Dither",!0)).changed(()=>{console.log("Dither toggle: "+n.checked())}),($=createSelect()).option("RGB"),$.option("HSV"),$.option("CMYK"),$.selected("RGB"),$.changed(()=>{console.log("Dither Select: "+$.value())}),(l=createCheckbox(" Toggle ACES",!0)).changed(()=>{console.log("ACES toggle: "+l.checked())}),(c=createCheckbox(" Toggle Kelvin Tint",!1)).changed(()=>{console.log("Kelvin Tint toggle: "+c.checked())}),d=createSpan("Kelvin Temperature: "),f=createInput(5e3,"number"),u=createSpan("Progress: "),S(5)},setup(){pixelDensity(1),createCanvas(windowWidth,windowHeight),loop()},draw(){if(!0===p){if(i){R=width*height,w=.016666666666666666*1e3,y=r.value(),T=n.checked(),k=l.checked(),B=c.checked(),G=f.value(),g=$.value(),S(height+5),loadPixels(),s?s=!1:o.loadPixels(pixels);for(var e=0;e<width;e++)for(var t=0;t<height;t++)for(var a=o.index(e,t),h=0;h<4;h++){var d=o.forOutput(a+h);pixels[a+h]=255*d}updatePixels(),_=!0,v=0,m=0}else alert("Try choosing image again");p=!1}else if(_&&!p){loadPixels(),u.html(D());for(var b=new Date,M=0;M<R;M++){var A,C,K,a=(A=v,C=m,K=width,(A+C*K)*4),P=[o.data[a+0],o.data[a+1],o.data[a+2],o.data[a+3]];k&&(P=LinearACES.ToneMap(P[0],P[1],P[2],P[3]));for(var h=0;h<4;h++)h<3&&(P[h]=sRGB.toSRGB(P[h]));if(B&&(P=Kelvin.Tint(P,G)),T){if("CMYK"===g){var E=CMYK.fromRGB(P);E=Dither.bayerArray(v,m,E,y),P=CMYK.toRGB(E)}else if("HSV"===g){var O=HSV.fromRGB(P);O=Dither.bayerArray(v,m,O,y),P=HSV.toRGB(O)}else P=Dither.bayerArray(v,m,P,y)}for(var h=0;h<4;h++)pixels[a+h]=Math.round(255*P[h])>>>0;if(++v>=width&&(v=0,m++),m>=height){_=!1,u.html(D()),console.log("-----PROCESS DONE -----");break}if(new Date-b>=w)break}updatePixels()}}}}();function preload(){Manager.preload()}function setup(){Manager.setup()}function draw(){Manager.draw()}