const Manager=function(){var e,i,t,o,n,r,a,$,g,h,s,l,d,c,f,u,p,v,_,R,m=!1,w=!1,T=0,k=0,y=0,z=0,B=31,b=!0,G=!0,M=!0,S=5e3;function F(i){var t=i;u.position(5,t),t+=u.height+10,e.position(4,t),t+=e.height+5,h.position(5,t),t+=h.height+10,p.position(5,t),t+=p.height+5,_.position(6,t),t+=h.height+15,l.position(5,t),t+=l.height+10,d.position(5,t),t+=d.height+5,c.position(5,t),f.position(c.width+25,t),t+=f.height+10,a.position(5,t),t+=a.height+5,r.position(5,t),n.position(r.width+20,t),t+=n.height+5,$.position(5,t)}function A(){B=n.value(),b=a.checked(),G=l.checked(),M=d.checked(),S=f.value(),g=$.value(),v=p.checked(),R=_.value()}function C(e,i,t){return(e+i*t)*4*pixelDensity()}function D(e){"image"==e.type&&(t=createImg(e.data,"","anonymous",E)).hide()}function E(){A();var e=document.getElementById("upload").files[0];loadImage(URL.createObjectURL(e),e=>{if(v){if("Fit Width"===R)e.resize(windowWidth,0);else if("Fit Height"===R)e.resize(0,windowHeight);else{var t=e.width/e.height,n=windowWidth/windowHeight;t>n?e.resize(windowWidth,0):t<n?e.resize(0,windowHeight):e.resize(windowWidth,0)}}resizeCanvas(e.width,e.height),i=new ImgWrap(width,height,ColorSpace.sRGB,pixelDensity()),background(28,28,28,0),image(e,0,0),m=!0,w=!1,o=!0,s=!1})}function K(){console.log("restart"),o&&(m=!0,w=!1,s=!0,background(0,0,0,0))}function P(){return"Progress: "+Math.floor((C(T,k,width)+3)/i.size*100)+"%"}return{preload(){(e=createFileInput(D)).id("upload"),(h=createButton("Restart")).mousePressed(K),r=createSpan("Dither Factor: "),n=createInput(31,"number"),(a=createCheckbox(" Toggle Dither",!0)).changed(()=>{console.log("Dither toggle: "+a.checked())}),($=createSelect()).option("RGB"),$.option("HSV"),$.option("CMYK"),$.selected("RGB"),$.changed(()=>{console.log("Dither Select: "+$.value())}),(l=createCheckbox(" Toggle ACES",!0)).changed(()=>{console.log("ACES toggle: "+l.checked())}),(d=createCheckbox(" Toggle Kelvin Tint",!1)).changed(()=>{console.log("Kelvin Tint toggle: "+d.checked())}),c=createSpan("Kelvin Temperature: "),f=createInput(5e3,"number"),u=createSpan("Progress: "),(p=createCheckbox(" Toggle Resize",!0)).changed(()=>{console.log("Resize Toggle: "+p.checked())}),(_=createSelect()).option("Fit Window"),_.option("Fit Width"),_.option("Fit Height"),_.selected("Fit Window"),_.changed(()=>{console.log("Resize Method: "+_.value())}),F(5)},setup(){createCanvas(windowWidth,windowHeight),loop()},draw(){if(!0===m){if(o){y=width*height,z=.016666666666666666*1e3,A(),F(height+5),loadPixels(),s?s=!1:i.loadPixels(pixels);for(var e=0;e<width;e++)for(var t=0;t<height;t++)for(var n=i.index(e,t,pixelDensity()),r=0;r<4;r++){var a=i.forOutput(n+r);pixels[n+r]=255*a}updatePixels(),w=!0,T=0,k=0}else alert("Try choosing image again");m=!1}else if(w&&!m){loadPixels(),u.html(P());for(var $=new Date,h=0;h<y;h++){var n=C(T,k,width),l=[i.data[n+0],i.data[n+1],i.data[n+2],i.data[n+3]];G&&(l=LinearACES.ToneMap(l[0],l[1],l[2],l[3]));for(var r=0;r<4;r++)r<3&&(l[r]=sRGB.toSRGB(l[r]));if(M&&(l=Kelvin.Tint(l,S)),b){if("CMYK"===g){var d=CMYK.fromRGB(l);d=Dither.bayerArray(T,k,d,B),l=CMYK.toRGB(d)}else if("HSV"===g){var c=HSV.fromRGB(l);c=Dither.bayerArray(T,k,c,B),l=HSV.toRGB(c)}else l=Dither.bayerArray(T,k,l,B)}for(var r=0;r<4;r++)pixels[n+r]=Math.round(255*l[r])>>>0;if(++T>=width&&(T=0,k++),k>=height){w=!1,u.html(P()),console.log("-----PROCESS DONE -----");break}if(new Date-$>=z)break}updatePixels()}}}}();function preload(){Manager.preload()}function setup(){Manager.setup()}function draw(){Manager.draw()}